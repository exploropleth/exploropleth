<p-splitter [panelSizes]="[20, 80]" [style]="{'height': '100vh'}" styleClass="w-100">
    <ng-template pTemplate="panel">
        <div class="w-100">
            <div class="p-md pb-none center-all">
                <img width="80%" alt="Exploropleth logo" src="assets/images/logo.png" />
            </div>
            <div class="text-center">
                <p class="mb-xs"><small class="text-muted">Choropleth&nbsp;Maps and Data&nbsp;Binning</small></p>
            </div>
            <hr>
            <div class="p-md pt-none overflow-auto" style="height: calc(100vh - 120px)">
                <div>
                    <div>
                        <i class="fa fa-database"></i>&nbsp;&nbsp;<strong class="tooltip-label"
                            pTooltip="Choose an indicator from one of our samples. Ability to upload custom dataset coming soon."
                            tooltipPosition="right">Dataset</strong>
                        &nbsp;&nbsp;
                        <p-cascadeSelect id="cascade-select-dataset-sample"
                            [ngModelOptions]="{standalone: true}" [options]="visModel['datasets']"
                            optionLabel="feature" optionGroupLabel="name" appendTo="body"
                            [optionGroupChildren]="['geographies','features']" [(ngModel)]="visModel['dataset']"
                            (ngModelChange)="loadSampleDataset()">
                        </p-cascadeSelect>
                    </div>
                    <div class="mt-sm text-center">
                        <small class="text-muted">
                            {{getDataShape("total")}} values; {{getDataShape("invalid")}}
                            ({{getDataShape("invalidpct")}}%) NaN/nulls
                        </small>
                    </div>
                    <div #attrDistributionVisContainer id="attrDistributionVisContainer" class="w-100 mt-sm">
                    </div>
                    <div class="mt-sm">
                        <table class="table-sm w-100">
                            <tbody>
                                <tr>
                                    <td style="width: 35%">
                                        <span
                                            pTooltip="Options to hide or show invalid (e.g., NaN, null) values."
                                            tooltipPosition="right" class="tooltip-label">
                                            NaN/nulls
                                        </span>
                                    </td>
                                    <td>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio"
                                                name="showInvalidValuesMode" id="showInvalidValuesOn"
                                                [(ngModel)]="visModel['showInvalidValues']" value="on"
                                                (ngModelChange)="renderAttrDistributionVisSpec();updateCurrentTab()"
                                                [ngModelOptions]="{standalone: true}">
                                            <label class="form-check-label" for="showInvalidValuesOn">
                                                show
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio"
                                                name="showInvalidValuesMode" id="showInvalidValuesOff"
                                                [(ngModel)]="visModel['showInvalidValues']" value="off"
                                                (ngModelChange)="renderAttrDistributionVisSpec();updateCurrentTab()"
                                                [ngModelOptions]="{standalone: true}">
                                            <label class="form-check-label" for="showInvalidValuesOff">
                                                hide
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <span
                                            pTooltip="Switch the above distribution plot between a histogram and a kernel density estimate (kde)."
                                            tooltipPosition="right" class="tooltip-label">
                                            Mode
                                        </span>
                                    </td>
                                    <td>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio"
                                                name="attrDistributionMode" id="attrDistributionModeHistogram"
                                                [(ngModel)]="visModel['attributeDistributionVisType']"
                                                value="histogram"
                                                (ngModelChange)="renderAttrDistributionVisSpec()"
                                                [ngModelOptions]="{standalone: true}">
                                            <label class="form-check-label" for="attrDistributionModeHistogram">
                                                histogram
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio"
                                                name="attrDistributionMode" id="attrDistributionKDE"
                                                [(ngModel)]="visModel['attributeDistributionVisType']"
                                                value="kde" (ngModelChange)="renderAttrDistributionVisSpec()"
                                                [ngModelOptions]="{standalone: true}">
                                            <label class="form-check-label" for="attrDistributionKDE">
                                                kde
                                            </label>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <hr>
                <div>
                    <div>
                        <img [src]="'assets/images/tasks-alt.svg'" width='16'
                            style="margin-top: -4px;" />&nbsp;&nbsp;<strong class="tooltip-label"
                            pTooltip="Options to configure binning methods. Note that not all options apply on all binning methods."
                            tooltipPosition="right">Data Binning</strong>
                    </div>
                    <div class="mt-sm">
                        <table class="table-sm w-100">
                            <tbody>
                                <tr>
                                    <td style="width: 35%">
                                        <span
                                            pTooltip="The high-level data binning categories to show in this tool session."
                                            tooltipPosition="right" class="tooltip-label">
                                            Categories
                                        </span>
                                    </td>
                                    <td>
                                        <p-multiSelect id="dctCategoriesFilter" name="dctCategoriesFilter"
                                            [placeholder]="'Filter for Binning Categories'"
                                            [options]="visModel['binningMethodCategoriesList']"
                                            [(ngModel)]="visModel['activeBinningMethodCategoriesList']"
                                            optionLabel="_name" optionValue="_id" display="chip"
                                            maxSelectedLabels="1"
                                            (onChange)="renderCompareVIS()" appendTo="body"
                                            [showClear]="false" [filter]="true" filterPlaceholder="Type here">
                                        </p-multiSelect>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 35%">
                                        <span pTooltip="The data binning methods to show in this tool session."
                                            tooltipPosition="right" class="tooltip-label">
                                            Methods
                                        </span>
                                    </td>
                                    <td>
                                        <p-multiSelect id="dctFilter" name="dctFilter"
                                            [placeholder]="'Filter for Binning Methods'"
                                            [options]="visModel['binningMethodsList']"
                                            [(ngModel)]="visModel['activeBinningMethodsList']"
                                            optionLabel="_name" optionValue="_id"
                                            (onChange)="renderCompareVIS()" appendTo="body"
                                            [showClear]="false" display="chip" maxSelectedLabels="1"
                                            [filter]="true" filterPlaceholder="Type here">
                                        </p-multiSelect>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 35%">
                                        <span
                                            pTooltip="Only applicable for Equal Interval, Quantile, Maximum Breaks, Natural Breaks, CK-Means, and Geometric Interval. For others, it is computationally determined by the method (e.g., Head-Tail Breaks) or is based on additional parameters (e.g. Defined Interval)."
                                            tooltipPosition="right" class="tooltip-label">
                                            Bin Count
                                        </span>
                                    </td>
                                    <td>
                                        <input type="number" step="1" min="1" max="12"
                                            (change)="updateBinguruObj();"
                                            [(ngModel)]="visModel['binCount']" name="binCount"
                                            id="binCount">
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 35%">
                                        <span pTooltip="Only applicable for the Defined Interval binning method"
                                            tooltipPosition="right" class="tooltip-label">
                                            Defined Bin Interval
                                        </span>
                                    </td>
                                    <td>
                                        <input type="number" step="0.001" min="0" max="999999" (change)="updateBinguruObj();"
                                            [(ngModel)]="visModel['binInterval']" name="binInterval"
                                            id="binInterval">
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <hr>
                <div>
                    <div>
                        <i class="fa fa-palette"></i>&nbsp;&nbsp;<strong class="tooltip-label"
                            pTooltip="Options to configure the color scheme for the choropleth maps."
                            tooltipPosition="right">Color Scheme</strong>
                    </div>
                    <div class="mt-sm">
                        <table class="table-sm w-100">
                            <tbody>
                                <tr>
                                    <td style="width: 35%">
                                        <span
                                            pTooltip="The base color scheme for valid (non NaN/null) values."
                                            tooltipPosition="right" class="tooltip-label">
                                            Palette
                                        </span>
                                    </td>
                                    <td>
                                        <p-cascadeSelect appendTo="body" [ngModelOptions]="{standalone: true}"
                                            [options]="visModel['colorSchemes']" optionLabel="sname"
                                            optionGroupLabel="name" [optionGroupChildren]="['examples']"
                                            (onChange)="updateCurrentTab()"
                                            [(ngModel)]="visModel['colorScheme']">
                                            <ng-template pTemplate="option" let-option>
                                                <table>
                                                    <tr>
                                                        <td class="p-xs">
                                                            <img height="20" width="150" *ngIf="option.sname"
                                                                [src]="'assets/colorSchemes/' + option.file + '.png'" />
                                                        </td>
                                                        <td class="p-xs">
                                                            <span>{{option.sname || option.name}}</span>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </ng-template>
                                            <ng-template pTemplate="value" let-option>
                                                <div *ngIf="option">
                                                    <img height="15" width="40"
                                                        [src]="'assets/colorSchemes/' + option.file + '.png'" />&nbsp;&nbsp;
                                                    <span>{{option.sname}}</span>
                                                </div>
                                            </ng-template>
                                        </p-cascadeSelect>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="width: 35%">
                                        <span pTooltip="The color to be used for invalid (NaN/null) values"
                                            tooltipPosition="right" class="tooltip-label">
                                            NaN/nulls
                                        </span>
                                    </td>
                                    <td>
                                        <input
                                            type="color"
                                            id="colorPicker-invalidValues"
                                            name="colorPicker-invalidValues"
                                            [(ngModel)]="visModel['invalidValuesColor']"
                                            [ngModelOptions]="{standalone: true}"
                                            [disabled]="!visModel['showInvalidValues']"
                                            (change)="updateCurrentTab()"
                                            style="width: 40px; height: 30px; border: none; background: none; padding: 0;"
                                        />
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>
    <ng-template pTemplate="panel">
        <div class="w-100">
            <ul class="nav nav-tabs" id="tabs-main" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="explore" href="#tab-explore" role="tab" data-toggle="tab"
                        aria-controls="tab-explore" aria-selected="true"><i
                            class="fas fa-globe"></i>&nbsp;Browse</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="compare" href="#tab-compare" role="tab" data-toggle="tab"
                        aria-controls="tab-compare" aria-selected="false"><i
                            class="fas fa-balance-scale-left"></i>&nbsp;Compare</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="combine" href="#tab-combine" role="tab" data-toggle="tab"
                        aria-controls="tab-combine" aria-selected="false"><i
                            class="fas fa-layer-group"></i>&nbsp;Combine</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="create" href="#tab-create" role="tab" data-toggle="tab"
                        aria-controls="tab-create" aria-selected="false"><i class="fas fa-edit"></i>&nbsp;Create</a>
                </li>
            </ul>
            <div class="tab-content" id="tabs-main-tabContent">
                <div class="tab-pane fade show active" id="tab-explore" role="tabpanel" aria-labelledby="explore">
                    <div class="overflow-auto h-full-usable p-md">
                        <div class="card-deck" id="choroplethcarddeck" dragula="CHOROPLETH_DRAGGABLE_CARDDECK">
                            <ng-container *ngFor="let dctItem of visModel['binningMethodsList']">
                                <div class="card card-borderless"
                                    [attr.id]="'choroplethcard-' + dctItem['_id']"
                                    (mouseover)="visModel['binningMethods'][dctItem['_id']]['isCardHovered'] = true"
                                    (mouseleave)="visModel['binningMethods'][dctItem['_id']]['isCardHovered'] = false"
                                    [ngClass]="{'card-bg-light': visModel['binningMethods'][dctItem['_id']]['isCardHovered'], 'fullscreen': visModel['binningMethods'][dctItem['_id']]['isCardFullscreen']}"
                                    [hidden]="!isMatchingSearchFilter(dctItem['_id'])">
                                    <div class="card-body p-sm w-100">
                                        <div style="position: relative">
                                            <span style="position: absolute; right: 0;"
                                                [hidden]="!visModel['binningMethods'][dctItem['_id']]['isCardHovered']">
                                                <a [routerLink]="" class="cursor-move"><small><i
                                                            class="fas fa-arrows-alt drag_handle"></i></small></a>&nbsp;
                                                <a [routerLink]=""
                                                    (click)="hideBinningMethodCard(dctItem['_id'])"
                                                    class="cursor-pointer"><small><i
                                                            class="fas fa-minus-circle"></i></small></a>&nbsp;
                                                <a [routerLink]="" class="cursor-pointer"
                                                    (click)="openShareModal(dctItem['_id'])">
                                                    <small><i class="fas fa-share-alt"></i></small>
                                                </a>&nbsp;
                                                <a [routerLink]="" class="cursor-pointer"
                                                    (click)="openDetailViewModal(dctItem['_id'])"><small><i
                                                            class="fas fa-expand"></i></small></a>&nbsp;
                                                <a [routerLink]=""
                                                    (click)="visModel['defaultBinningMethod'] = dctItem['_id']; editManualIntervalCreate(true)"
                                                    class="cursor-pointer"><small><i class="fas fa-edit"></i></small></a>
                                            </span>
                                        </div>
                                        <div style="position: relative">
                                            <small style="position: absolute; left: 0; top: 2px; font-size:0.6em;"
                                                class="badge"
                                                [ngClass]="getBinningMethodCategoryStyleClass(visModel['binningMethods'][dctItem['_id']]['category'])">{{visModel['binningMethods'][dctItem['_id']]["category"]}}</small>
                                        </div>
                                        <div>
                                            <h5 class="card-title mb-sm text-center ml-md">
                                                {{visModel['binningMethods'][dctItem['_id']]["name"]}}
                                            </h5>
                                        </div>
                                        <p class="card-text text-muted text-center">
                                            <span>{{visModel['binningMethods'][dctItem['_id']]["description"]}}</span>
                                        </p>
                                        <div class="text-center w-100" #mapContainerBrowse
                                            [attr.id]="'mapContainerBrowse-' + dctItem['_id']">
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab-compare" role="tabpanel" aria-labelledby="compare">
                    <div class="overflow-auto h-full-usable p-md">
                        <div #attrDistributionVisContainerCompare id="attrDistributionVisContainerCompare"
                            style="margin-left: 145px; margin-right: 0px;"></div>
                        <div id="mapContainerCompare" #mapContainerCompare dragula="CHOROPLETH_DRAGGABLE_COMPAREVIS">
                            <ng-container *ngFor="let dctItem of visModel['binningMethodsList']">
                                <div class="card card-borderless"
                                    (mouseover)="visModel['binningMethods'][dctItem['_id']]['isCardHovered'] = true"
                                    (mouseleave)="visModel['binningMethods'][dctItem['_id']]['isCardHovered'] = false"
                                    [ngClass]="{'bg-light': visModel['binningMethods'][dctItem['_id']]['isCardHovered']}"
                                    [hidden]="!isMatchingSearchFilter(dctItem['_id'])" style="display: table;">
                                    <div
                                        style="display: table-cell; vertical-align: top; padding-top: 8px; padding-right: 8px; text-align: right; white-space: nowrap; width: 200px;">
                                        <strong>{{ visModel['binningMethods'][dctItem['_id']]['name']
                                            }}</strong>
                                    </div>
                                    <div style="display: table-cell;" 
                                        [attr.id]="'mapContainerCompare-' + dctItem['_id']"></div>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab-combine" role="tabpanel" aria-labelledby="combine">
                    <p-splitter [panelSizes]="[20, 80]" [style]="{'height': '100vh'}" styleClass="w-100">
                        <ng-template pTemplate="panel">
                            <div class="w-100 p-md overflow-auto">
                                <h3>Resiliency</h3>
                                <p>This is an ensemble technique that considers how frequently a geographic
                                    entity
                                    (e.g., county) falls in a particular bin across multiple comparable data
                                    binning methods. Read more about Resiliency in our <a
                                        href="https://drops.dagstuhl.de/entities/document/10.4230/LIPIcs.GIScience.2023.55"
                                        target="_blank">GIScience paper</a>.</p>

                                <div>
                                    <div class="mb-sm">
                                        <strong class="tooltip-label"
                                            pTooltip="Pick one or more of these binning methods to compare by overlaying their bin sizes and bin breaks; note that these methods all have a fixed number of bins to be comparable."
                                            tooltipPosition="right">Binning Methods</strong>
                                    </div>

                                    <div class="form-check"
                                        *ngFor="let bm of objectKeys(visModel['binningMethodInputsForResiliency']);">
                                        <input
                                            name="'special-comparison-checkbox-' + {{bm}}"
                                            class="form-check-input" type="checkbox"
                                            [(ngModel)]="visModel['binningMethodInputsForResiliency'][bm]['selected']"
                                            (ngModelChange)="updateCurrentTab()"
                                            [ngModelOptions]="{standalone: true}"
                                            id="'special-comparison-checkbox-' + {{bm}}">
                                        <label class="form-check-label"
                                            for="'special-comparison-checkbox-' + {{bm}}">{{visModel['binningMethods'][bm]['name']}}</label>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="panel">
                            <div class="w-100 p-md overflow-auto">
                                <div #mapContainerCombine id="mapContainerCombine" class="text-center">
                                </div>
                                <hr>
                                <div #specialMapContainerCombine id="specialMapContainerCombine"
                                    class="text-center">
                                </div>
                            </div>
                        </ng-template>
                    </p-splitter>
                </div>
                <div class="tab-pane fade" id="tab-create" role="tabpanel" aria-labelledby="create">
                    <p-splitter [panelSizes]="[30, 70]" [style]="{'height': '100vh'}" styleClass="w-100">
                        <ng-template pTemplate="panel">
                            <div class="w-100 p-md overflow-auto">
                                <div>
                                    <strong><i class="fa fa-edit"
                                            pTooltip="Specify custom bins from scratch or modify existing binning method outputs (via Reset)."
                                            tooltipPosition="right"></i>&nbsp;Manual Configuration</strong>
                                    <div>
                                        <small class="text-muted">Specify
                                            custom bins from scratch or modify existing binning method outputs
                                            (via Reset).</small>
                                    </div>
                                    <div class="mt-md">
                                        <button (click)="addBin()" class="btn btn-sm btn-outline-secondary"><i
                                                class="fa fa-plus"></i>&nbsp;Add Bin</button>
                                        &nbsp;
                                        <button (click)="deleteBin(); updateColorScaleAndMap();"
                                            class="btn btn-sm btn-outline-secondary"><i
                                                class="fa fa-times"></i>&nbsp;Remove</button>
                                        &nbsp;
                                        <p-splitButton 
                                            label="Redo" 
                                            size="small"
                                            outlined="true"
                                            rounded="true"
                                            severity="secondary"
                                            icon="fa fa-redo" 
                                            appendTo="body" 
                                            [model]="visModel['binningMethodResetMenu']"
                                            (onClick)="renderMap()">
                                        </p-splitButton>
                                    </div>
                                    <div class="table-responsive mt-md">
                                        <table class="table table-bordered table-sm text-center mb-none" *ngIf="visModel['bins'] && objectKeys(visModel['bins']).length > 0">
                                            <tbody>
                                                <tr *ngFor="let binIdx of objectKeys(visModel['bins']); let index = index; trackBy: binIdx;">
                                                    <td style="width: 40%">
                                                        <ng-container
                                                            *ngIf="visModel['bins'][binIdx]['domain_from'] != null && visModel['bins'][binIdx]['domain_from'].toString() == 'Infinity'; else elseBlock1;">
                                                            <span>-</span>
                                                        </ng-container>
                                                        <ng-template #elseBlock1>
                                                            <span style="height: 30px;">
                                                                <ng-container
                                                                    *ngIf="visModel['bins'][binIdx]['domain_from'] != null && visModel['bins'][binIdx]['domain_from'].toString() == '-Infinity' else elseBlock2;">
                                                                    <span>-&#8734;</span>
                                                                    <!-- negative infinity symbol-->
                                                                </ng-container>
                                                                <ng-template #elseBlock2>
                                                                    {{visModel['bins'][binIdx]['domain_from']
                                                                    | number: '1.2-3'}}
                                                                </ng-template>
                                                            </span>
                                                        </ng-template>
                                                    </td>
                                                    <td style="width: 20%">
                                                        <input
                                                            type="color"
                                                            [id]="'colorPicker-' + binIdx"
                                                            [name]="'colorPicker-' + binIdx"
                                                            [(ngModel)]="visModel['bins'][binIdx]['color']"
                                                            [ngModelOptions]="{standalone: true}"
                                                            (change)="onColorPickerSelect($event.target.value, index)"
                                                            style="width: 40px; height: 30px; border: none; background: none; padding: 0;"
                                                        />
                                                    </td>
                                                    <td style="width: 40%">
                                                        <ng-container
                                                            *ngIf="visModel['bins'][binIdx]['domain_to'] != null && visModel['bins'][binIdx]['domain_to'].toString() == 'Infinity'&& (objectKeys(visModel['bins']).length - 1).toString() == binIdx; else elseBlock3;">
                                                            <span>&#8734;</span>
                                                            <!--infinity symbol-->
                                                        </ng-container>
                                                        <ng-template #elseBlock3>
                                                            <input style="width: 100%; height: 30px;"
                                                                name="'domain_to-' + binIdx"
                                                                [ngModelOptions]="{standalone: true}"
                                                                type="number"
                                                                (keyup)="onChangeDomain(visModel['bins'][binIdx]['domain_to'], index)"
                                                                (change)="onChangeDomain(visModel['bins'][binIdx]['domain_to'], index)"
                                                                [value]="visModel['bins'][binIdx]['domain_to']"
                                                                [(ngModel)]="visModel['bins'][binIdx]['domain_to']"
                                                                step="1" />
                                                        </ng-template>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="alert alert-warning p-2 mt-2 mb-2">
                                        <i class="fa fa-exclamation-triangle"></i>&nbsp;Warning: Please ensure that bins increase in value and are continuous.
                                    </div>
                                </div>
                                <hr>
                                <div>
                                    <div><strong><i class="fa fa-paint-roller"
                                                pTooltip="Enable or disable Paint Mode."
                                                tooltipPosition="right"></i>&nbsp;Paint Mode</strong>
                                        <span class="float-right">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="paintMode"
                                                    id="paintModeOn" [(ngModel)]="visModel['paintMode']"
                                                    value="on" [ngModelOptions]="{standalone: true}">
                                                <label class="form-check-label" for="paintModeOn">
                                                    on
                                                </label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="paintMode"
                                                    id="paintModeOff" [(ngModel)]="visModel['paintMode']"
                                                    value="off" [ngModelOptions]="{standalone: true}">
                                                <label class="form-check-label" for="paintModeOff">
                                                    off
                                                </label>
                                            </div>
                                        </span>
                                        <div style="clear:both"></div>
                                        <div>
                                            <small class="text-muted">Create custom bins by selecting a color
                                                (i.e. an existing bin) and then clicking on a geography (i.e.
                                                forcing it to fall in the bin) to fit a specific
                                                narrative.</small>
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="visModel['paintMode'] == 'on'">
                                    <div>
                                        <div class="mt-2">
                                            <div *ngFor="let presetColor of visModel['presetColors']"
                                                [style.background]="presetColor"
                                                (click)="visModel['currentColor'] = presetColor;"
                                                [class.selectedColorSwatch]="presetColor === visModel['currentColor']"
                                                class="colorSwatch"></div>
                                        </div>
                                        <div class="alert alert-warning p-2 mt-2 mb-2">
                                            <i class="fa fa-exclamation-triangle"></i>&nbsp;Warning: We
                                            recommend using this feature only for educational purposes.
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div>
                                    <div><strong><i class="fa fa-save"
                                                pTooltip="Save the binning by giving it a name."
                                                tooltipPosition="right"></i>&nbsp;Save As New Binning Method
                                        </strong>
                                    </div>
                                    <div class="input-group mt-md mb-3">
                                        <input type="text" class="form-control"
                                            placeholder="E.g., 'custom method 1'"
                                            aria-label="E.g., 'custom method 1'" aria-describedby="basic-addon"
                                            [(ngModel)]="visModel['newBinningMethodName']">
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary" type="button"
                                                [disabled]="visModel['newBinningMethodName']==''"
                                                (click)="saveNewBinningMethod();"><i
                                                    class="fas fa-save"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template pTemplate="panel">
                            <div class="w-100 overflow-auto" style="position:relative;">
                                <div style="position: absolute; top: 8px; right: 8px;">
                                    <div class="input-group" style="width: 350px;">
                                        <input class="form-control" placeholder="Lookup Geographic Entity"
                                            [(ngModel)]="visModel['geographicSearchTerm']"
                                            (keyup.enter)="searchGeographicEntity()"
                                            (input)="onGeographicSearchInput()"
                                            [ngModelOptions]="{standalone: true}" />
                                        <div class="input-group-append">
                                            <button class="btn btn-outline-secondary bg-white" type="button"
                                                (click)="searchGeographicEntity()"
                                                [disabled]="!visModel['geographicSearchTerm'] || visModel['geographicSearchTerm'].trim() === ''">
                                                <i class="fas fa-search"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary bg-white" type="button"
                                                (click)="clearGeographicSearch()"
                                                [disabled]="!visModel['highlightedGeographicEntity']">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div *ngIf="visModel['geographicSearchResults'] && visModel['geographicSearchResults'].length > 0"
                                        class="search-results-dropdown">
                                        <div class="search-results-list">
                                            <div *ngFor="let result of visModel['geographicSearchResults']"
                                                class="search-result-item"
                                                [class.no-result]="result.primaryKey === null"
                                                (click)="result.primaryKey !== null ? selectGeographicEntity(result) : null">
                                                {{result.displayLabel || result.label}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div #mapContainerCreate id="mapContainerCreate" class="h-full-usable text-center"></div>
                            </div>
                        </ng-template>
                    </p-splitter>
                </div>
            </div>
        </div>
    </ng-template>
</p-splitter>